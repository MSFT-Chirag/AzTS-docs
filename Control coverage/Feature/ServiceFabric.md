## Service Fabric

| ControlId | Dependent Azure API(s) and Properties | Control spec-let |
|-----------|-------------------------------------|------------------|
| <b>ControlId:</b><br> Azure_ServiceFabric_DP_Dont_Expose_Reverse_Proxy_Port <br><b>DisplayName:</b><br>Reverse proxy port must not be exposed publicly. <br><b>Description: </b><br> Reverse proxy port must not be exposed publicly.| <b> ARM API to get the list of Service Fabric cluster <br>resources created in the specified subscription:</b><br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric<br>/clusters?api-version=2018-02-01 <br><br><b>Properties:</b><br> properties.nodeTypes[\*].reverseProxyEndpointPort <br> <br> <b> ARM API to get all the load balancers in a subscription. </b> /subscriptions/{subscriptionId}/providers/Microsoft.Network/loadBalancers? <br> api-version=2019-12-01 <br><b>Properties:</b><br> Tags <br> backendAddressPools[].properties. backendIPConfigurations[].id | <b>Passed: </b><br>Reverse proxy endpoints ports list is empty. <br><b>Failed: </b><br>Reverse proxy endpoints ports found and ports are opened using public load balancer on SF.|
| <b>ControlId:</b><br>Azure_ServiceFabric_DP_Set_Property_ClusterProtectionLevel<br><b>DisplayName:</b><br> The ClusterProtectionLevel property must be set to EncryptAndSign. <br><b>Description: </b><br> The ClusterProtectionLevel property must be set to EncryptAndSign.|<b> ARM API to get the list of Service Fabric cluster <br>resources created in the specified subscription:</b><br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric<br>/clusters?api-version=2018-02-01 <br><br><b>Properties:</b><br> fabricSettings.Security.ClusterProtectionLevel | <b>Passed: </b><br> Cluster protection level is set to "EncryptAndSign". <br><b>Failed: </b><br> Cluster protection level is not set to "EncryptAndSign".
| <b>ControlId:</b><br>Azure_ServiceFabric_AuthN_NSG_Enabled<br><b>DisplayName:</b><br> Firewall/NSGs must be enabled on subnet of Service Fabric cluster. <br><b>Description: </b><br> Network security group (NSG) must be enabled on subnets of Service Fabric cluster.|<b> ARM API to get the list of Service Fabric cluster <br>resources created in the specified subscription:</b><br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric<br>/clusters?api-version=2018-02-01 <br><br><b>Properties:</b><br> properties.nodeTypes[\*].name <br><br><b> ARM API to list Virtual Machine scale sets at subscription level:</b><br> /subscriptions/{subscriptionId}/providers/Microsoft.Compute<br>/virtualMachineScaleSets<br>?api-version=2019-07-01 <br><b>Properties:</b><br> tags, properties.virtualMachineProfile.networkProfile.<br>networkInterfaceConfigurations[\*].properties.ipConfigurations[\*]<br>.properties.subnet.id <br><br><b>ARM API to list Virtual Networks at <br>subscription level:</b><br>/subscriptions/{subscriptionId}/providers<br>/Microsoft.Network/virtualNetworks<br>?api-version=2019-11-01<br><b>Property:</b><br>networkSecurityGroup/id<br><br><b>ARM API to list Network Security Groups at <br>subscription level:</b><br>/subscriptions/{subscriptionId}/providers<br>/Microsoft.Network/networkSecurityGroups<br>?api-version=2019-04-01<br><b>Property:</b><br>destinationPortRange, destinationPortRanges<br>| <b>Passed: </b><br> NSG is configured with no restricted ports (e.g. RDP 3389, SMB 445 etc.) open using NSG rules. <br><b>Failed: </b><br> NSG is not configured or any restricted ports (e.g. RDP 3389, SMB 445 etc.) are open using NSG rules. <br><b>Verify: </b><br> No linked Virtual Machine scale set node found. |
| <b>ControlId:</b><br>Azure_ServiceFabric_AuthN_Client_AuthN_AAD_Only<br><br><b>DisplayName:</b><br>Use Azure Active directory for client authentication on Service Fabric clusters.<br><br><b>Description: </b><br> Client authentication must be performed only via Azure Active Directory. | <b> ARM API to get the list of Service Fabric cluster <br>resources created in the specified subscription:</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric<br>/clusters?api-version=2018-02-01 <br><br> <b>Properties:</b><br> properties.azureActiveDirectory/tenantId, <br> properties.certificate | <b>Scope: </b> Applies on all Service Fabric cluster resources.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> AAD is enabled on Service Fabric. <br><br> <b>Failed: </b><br> 1. AAD is not enabled on Service Fabric. <br> 2. AAD is not enabled on Service Fabric *and* Anonymous access is enabled. |
| <b>ControlId:</b><br>Azure_ServiceFabric_AuthZ_Security_Mode_Enabled<br><br><b>DisplayName:</b><br>Service Fabric cluster security must be enabled using security mode option.<br><br><b>Description: </b><br> Service Fabric cluster security must be enabled using security mode option. | <b> ARM API to get the list of Service Fabric cluster <br>resources created in the specified subscription:</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric<br>/clusters?api-version=2018-02-01 <br><br> <b>Properties:</b><br> properties.certificate | <b>Scope:</b> Applies on all Service Fabric cluster resources.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> Service Fabric cluster is secured with certificate.<br><br><b>Failed: </b><br> Service Fabric cluster is not secured with certificate. |
| <b>ControlId:</b><br>Azure_ServiceFabric_SI_Set_Auto_Update_Cluster<br><br><b>DisplayName:</b><br>Upgrade mode should be set to automatic for cluster.<br><br><b>Description: </b><br> Upgrade mode should be set to automatic for cluster. | <b> ARM API to get the list of Service Fabric cluster <br>resources created in the specified subscription:</b><br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric<br>/clusters?api-version=2018-02-01 <br><br><b>Properties:</b><br> properties.upgradeMode | <b>Scope: </b> Applies on all Service Fabric cluster resources.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> Upgrade mode for cluster is set to automatic. <br><br> <b>Failed: </b><br> Upgrade mode for cluster is set to manual. |
| <b>ControlId:</b><br>Azure_ServiceFabric_Audit_Publicly_Exposed_Load_Balancer_Ports<br><br><b>DisplayName:</b><br> Monitor publicly exposed ports on load balancers used by Service Fabric cluster.<br><br><b>Description: </b><br> Monitor publicly exposed ports on load balancers used by Service Fabric cluster. | <b> ARM API to get the list of NSG security rules <br>using Load Balancer linked to Service Fabric cluster.</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.Network<br>/loadBalancers?api-version=2019-12-01<br><br> <b>Properties:</b><br> properties.loadBalancingRules | <b>Scope: </b> Applies on all Service Fabric cluster resources.<br><br><b>Config: </b> RestrictedPorts: [19000, 19080, 445, 3389, 5985, 22]<br><br> <b>Passed: </b><br> Any NSG has restricted ports (e.g. RDP 3389, SMB 445 etc.) opened using Load Balancer linked to Service Fabric. <br><br> <b>Failed: </b><br> No NSG has restricted ports opened using Load Balancer linked to Service Fabric. |