## SQL Server

| ControlId | Dependent Azure API(s) and Properties | Control spec |
|-----------|-------------------------------------|------------------|
| <b>ControlId:</b><br>Azure_SQLDatabase_Audit_Enable_Threat_Detection_Server<br><br><b>DisplayName:</b><br>Advanced data security must be enabled on your SQL servers.<br><br><b>Description: </b><br> Enable SQL Server threat detection with email admins option. Do not exclude any detection types. |<b> ARM API to lists all the SQL servers under the subscription. </b> </br> /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{ServerName}/securityAlertPolicies/default?api-version=2017-03-01-preview <br><br><b>Properties:</b><br> AuditSetting, AlertPolicies, AuditState, EmailAccountAdmins, DisabledAlerts, EmailAddresses | <b>Scope: </b>  Applies to all Azure SQL Server types. <br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br>a. 'Auditing' is enabled. <br>*and*<br> b. 'Advanced data security' setting is enabled.<br>*and*<br>c. All 'Advanced Threat Protection types' are selected.<br> *and*<br> d. Either the 'Send email notification to admins and subscription owners' option is selected *or* the user has explicitly provided email id to which the notification should be sent. <br><br> <b>Failed: </b><br> a. 'Auditing' is disabled. <br>*or*<br> b. 'Advanced data security' setting is disabled.<br>*or*<br>c. All 'Advanced Threat Protection types' are not selected.<br> *or*<br> d. At least one of them are not configured. <br> 1. 'Send email notification to admins and subscription owners' option is selected. <br>2. The user has explicitly provided email id to which the notification should be sent.|
| <b>ControlId:</b><br>Azure_SQLDatabase_Audit_Enable_Vuln_Assessment<br><br><b>DisplayName:</b><br>Vulnerability assessment must be enabled on your SQL servers.<br><br><b>Description: </b><br> Enable SQL Server vulnerability assessments with email admins option. |<b> ARM API to lists all the SQL servers under the subscription.</b> </br>/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{ServerName}/vulnerabilityAssessments/default?api-version=2018-06-01-preview <br><br><b>Properties:</b><br> VulnerabilityAssessmentSetting, IsEnabled, EmailSubscriptionAdmins, Emails, StorageContainerPath | <b>Scope: </b>  Applies to all Azure SQL Server types. <br><br><b>Config: </b> UnsupportedTier: Basic<br><br> <b>Passed: </b><br> a. Vulnerability assessment setting is enabled.<br> *and*<br> b. The storage container path has been specified where the logs will be stored.<br> *and*<br> c. Either the 'Send email notification to admins and subscription owners' option is selected or the user has explicitly provided email id to which the notification should be sent. <br><br> <b>Failed: </b><br> a. Vulnerability assessment setting is not enabled.  <br> *or* <br> b. Storage account container path is not selected. <br> *or* <br> c. At least one of them are not configured. <br> 1. 'Send email notification to admins and subscription owners' option is selected. <br>2. The user has explicitly provided email id to which the notification should be sent.<br><br>*Note: This control is enforced at server level which always applies to the database, regardless of the database settings.* |
| <b>ControlId:</b><br>Azure_SQLDatabase_AuthZ_Use_AAD_Admin<br><br><b>DisplayName:</b><br>SQL Database must use AAD authentication.<br><br><b>Description: </b><br> Enable Azure AD admin for the SQL Database. |<b> ARM API to lists all the SQL servers under the subscription.  </b> </br> /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{ServerName}/administrators?api-version=2014-04-01 <br><br><b>Properties:</b><br> IsADAdministratorEnabled | <b>Scope: </b> Applies to all Azure SQL Server types. <br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> Active directory administrator is enabled on SQL Server. <br><br> <b>Failed: </b><br> No Active Directory admin is enabled on SQL Server.|
| <b>ControlId:</b><br>Azure_SQLDatabase_DP_Enable_TDE<br><br><b>DisplayName:</b><br>Transparent data encryption (TDE) must be enabled.<br><br><b>Description: </b><br> Transparent data encryption (TDE) must be enabled. |<b> ARM API to lists all the SQL server DB under the subscription.  </b> </br> /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{ServerName}/databases/{DBName}/transparentDataEncryption/current?api-version=2014-04-01 <br><br><b>Properties:</b><br> Databases, TDEStatus | <b>Scope: </b> Applies to all Azure SQL Server types. <br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> a. No database is present for SQL server.<br> *or* <br> b. All databases for SQL server have transparent data encryptoin enabled.<br><br> <b>Failed: </b><br> One or more databases for SQL server do not have transparent data encryption enabled.|
