## Virtual Network

| ControlId | Dependent Azure API(s) and Properties | Control spec |
|-----------|-------------------------------------|------------------|
| <b>ControlId:</b><br>Azure_ERvNet_NetSec_Dont_Add_UDRs_on_Subnets<br><br><b>DisplayName:</b><br>There must not be a UDR on *any* subnet in an ExpressRoute-connected VNet.<br><br><b>Description: </b><br> There must not be a UDR on *any* subnet in an ExpressRoute-connected VNet.| <br><b>ARM API to list Virtual Networks and route table associated with each subnet of VNet at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworks?<br>api-version=2019-11-01 <br><br><b>Properties:</b><br> properties.subnets[\*].properties.routeTable.id <br><br><b>ARM API to list Virtual Network Gateways at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworkGateways?<br>api-version=2019-04-01 <br><br><b>Properties:</b><br>properties.gatewayType <br><br><b> ARM API to list all Route Tables at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Network/routeTables?api-version=2020-03-01 <br><br><b>Properties:</b><br> properties.routes[\*].name <br> properties.routes[\*].properties.addressPrefix <br> properties.routes[\*].properties.nextHopType| <b>Scope: </b> Applies to all Azure Virtual Network.<br><br><b>Config: </b> ApprovedRG: ERNetwork-LAB, <br> ApprovedAddressPrefix: 0.0.0.0/0, <br> ApprovedNextHopType: VirtualAppliance<br><br> <b>Passed: </b><br>1. No UDRs found on any Subnet of ERvNet. <br> 2. Only exempted UDR(s) are defined in subnet of ERvNet.<br><br> <b>Failed: </b><br> UDRs are attached to one or more subnets in ERvNet. <br><br><b>NotApplicable: </b><br>Current VNet resource object is not connected to ExpressRoute gateway. |
| <b>ControlId:</b><br>Azure_ERvNet_NetSec_Dont_Use_VNet_Peerings<br><br><b>DisplayName:</b><br>Peering must not be allowed on ExpressRoute connected Virtual Network. <br><br><b>Description: </b><br> There must not be any virtual network peering on an ExpressRoute-connected VNet.| <b> ARM API to list Virtual Networks and their peering at subscription level: </b> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworks? <br> api-version=2019-11-01 <br><br><b>Properties:</b><br> properties.virtualNetworkPeerings[\*].id <br> properties.virtualNetworkPeerings[\*].properties.remoteVirtualNetwork.id <br> <br> <b> ARM API to list Virtual Network Gateways at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworkGateways?<br>api-version=2019-04-01 <br><br><b>Properties:</b><br> properties.gatewayType | <b>Scope: </b> Applies to all Azure Virtual Network.<br><br><b>Config: </b> ApprovedRGs: ERNetwork-LAB, <br> ApprovedRemoteVirtualNetworkId: /subscriptions/45a7f642-6aac-4fc2-914b-0b2eeb1c7974/<br><br> <b>Passed: </b><br>No peering found on ERvNet. <br> Only exempted peering are defined in ERvNet.<br><br> <b>Failed: </b><br>One or more non exempted peering found on ERvNet. <br><br><b>NotApplicable: </b><br> Current VNet resource object is not connected to ExpressRoute gateway. |
| <b>ControlId:</b><br>Azure_ERvNet_NetSec_Dont_Add_VPN_Gateways<br><br><b>DisplayName:</b><br> There must not be another virtual network gateway (GatewayType = Vpn) in an ExpressRoute-connected VNet. <br><br><b>Description: </b><br> There must not be another virtual network gateway (GatewayType = Vpn) in an ExpressRoute-connected VNet.| <b> ARM API to list Virtual Networks and their subnets at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworks? <br>api-version=2019-11-01 <br><br><b>Properties:</b><br> properties.subnets[\*].id <br><br> <b> ARM API to list Virtual Network Gateways at subscription level: </b> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworkGateways?</br> api-version=2019-04-01 <br><br><b>Properties:</b><br> properties.gatewayType | <b>Scope: </b> Applies to all Azure Virtual Network.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br>No other types of gateways found on the VNet other than ExpressRoute.<br><br> <b>Failed: </b><br>Gateways of type other than ExpressRoute are found on the VNet.<br><br><b>NotApplicable: </b><br>Current VNet resource object is not connected to ExpressRoute gateway. |
| <b>ControlId:</b><br>Azure_ERvNet_NetSec_Dont_Use_PublicIPs<br><br><b>DisplayName:</b><br> There must not be any public IPs on ER connected VMs. <br><br><b>Description: </b><br> There must not be any Public IPs (i.e., NICs with PublicIP) on ExpressRoute-connected VMs.| <b> ARM API to list Virtual Networks and their subnets at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Network/virtualNetworks? <br>api-version=2019-11-01 <br><br> <b>Properties:</b><br> properties.subnets[\*].id <br> | <b>Scope: </b> Applies to all Azure Virtual Network.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br>No NICs found on the ERvNet.  <br> *or* <br> No Public IP is configured for any NIC on the ERvNet.<br><br> <b>Failed: </b><br>public IP(s) are configured for one or more NICs attached to ERvNet.<br><br><b>NotApplicable: </b><br>Current VNet resource object is not connected to ExpressRoute gateway. |
| <b>ControlId:</b><br>Azure_ERvNet_SI_Dont_Remove_Resource_Lock<br><br><b>DisplayName:</b><br> Ensure that the ERNetwork resource group is protected with a resource lock. <br><br><b>Description: </b><br> Ensure that the ERNetwork resource group is protected with a resource lock.| <b> ARM API to list Virtual Networks and their subnets at subscription level: </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.Authorization/locks?api-version=2015-01-01 <br><br> <b>Properties:</b><br> LocksDetails | <b>Scope: </b> Applies to all Azure Virtual Network.<br><br><b>Config: </b> LockLevel<br><br> <b>Passed: </b><br>Lock (delete or read-only) is configured at RG scope.<br><br> <b>Failed: </b><br>Lock (delete or read-only) is not configured at RG scope.<br><br><b>NotApplicable: </b><br>Current VNet resource object is not connected to ExpressRoute gateway. |


