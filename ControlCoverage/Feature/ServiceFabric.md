## Service Fabric

| ControlId | Dependent Azure API(s) and Properties | Control spec |
|-----------|-------------------------------------|------------------|
| <b>ControlId:</b><br> Azure_ServiceFabric_DP_Dont_Expose_Reverse_Proxy_Port <br><br><b>DisplayName:</b><br>Reverse proxy port must not be exposed publicly. <br><br><b>Description: </b><br> Reverse proxy port must not be exposed publicly.| <b> ARM API to get the list of Service Fabric cluster resources created in the specified subscription - Gets all Service Fabric cluster resources created or in the process of being created in the subscription. </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric/clusters?<br>api-version=2018-02-01<br><br><b>Properties:</b><br> properties.nodeTypes[\*].reverseProxyEndpointPort <br> <br> <b> ARM API to get all the load balancers in a subscription. </b> /subscriptions/{subscriptionId}/providers/Microsoft.Network/loadBalancers? <br> api-version=2019-12-01 <br><br><b>Properties:</b><br> Tags <br> backendAddressPools[].properties. backendIPConfigurations[].id | <b>Scope: </b> Applies to all Azure Service Fabric.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br>Reverse proxy endpoints ports list is empty. <br><br> <b>Failed: </b><br>Reverse proxy endpoints ports found and ports are opened using public load balancer on SF.|
| <b>ControlId:</b><br>Azure_ServiceFabric_DP_Set_Property_ClusterProtectionLevel<br><br><b>DisplayName:</b><br> The ClusterProtectionLevel property must be set to EncryptAndSign. <br><br><b>Description: </b><br> The ClusterProtectionLevel property must be set to EncryptAndSign. | <b> ARM API to get the list of Service Fabric cluster resources created in the specified subscription - Gets all Service Fabric cluster resources created or in the process of being created in the subscription. </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric/clusters? <br> api-version=2018-02-01 <br><br><b>Properties:</b><br> fabricSettings.Security.ClusterProtectionLevel | <b>Scope: </b> Applies to all Azure Service Fabric.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> Cluster protection level is set to "EncryptAndSign". <br><br> <b>Failed: </b><br> Cluster protection level is not set to "EncryptAndSign". |
| <b>ControlId:</b><br>Azure_ServiceFabric_AuthN_Client_AuthN_AAD_Only<br><br><b>DisplayName:</b><br> Service Fabric clusters must only use Azure Active Directory for client authentication. <br><br><b>Description: </b><br> Client authentication must be performed only via Azure Active Directory. | <b> ARM API to get the list of Service Fabric cluster resources created in the specified subscription - Gets all Service Fabric cluster resources created or in the process of being created in the subscription. </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric/clusters?api-version=2018-02-01 <br><br><b>Properties:</b><br> IsAADEnabled, certDetails | <b>Scope: </b> Applies to all Azure Service Fabric.<br><br><b>Config: </b> NA<br><br> <b>Passed: </b><br> AAD auth is enabled on SF cluster management endpoint. <br><br> <b>Failed: </b><br> AAD auth is not enabled on SF cluster management endpoint. |


| <b>ControlId:</b><br>Azure_ServiceFabric_AuthN_NSG_Enabled<br><br><b>DisplayName:</b><br> Firewall/NSGs must be enabled on subnet of Service Fabric cluster. <br><br><b>Description: </b><br> Network security group (NSG) must be enabled on subnets of Service Fabric cluster. | <b> ARM API to get the list of Service Fabric cluster resources created in the specified subscription - Gets all Service Fabric cluster resources created or in the process of being created in the subscription. </b> <br> /subscriptions/{subscriptionId}/providers/Microsoft.ServiceFabric/clusters? <br> api-version=2018-02-01 <br><br><b>Properties:</b><br> fabricSettings.Security.ClusterProtectionLevel | <b>Scope: </b> Windows and Linux SF cluster.<br><br><b>Config: </b> RestrictedPorts: 445,3389,5985,22<br><br> <b>Passed: </b><br> NSG is configured with no restricted ports (e.g. RDP 3389, SMB 445 etc.) open using NSG rules. <br><br> <b>Failed: </b><br> a. NSG is not configured <br> *or* <br>b. Any-to-any inbound rule is found <br> *or* <br> c. Restricted port(s) is found to be in the inbound rule range. |